<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>Bitcoin: Object/Message/Block.c Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body onload='searchBox.OnSelectItem(0);'>
<!-- Generated by Doxygen 1.7.4 -->
<script type="text/javascript"><!--
var searchBox = new SearchBox("searchBox", "search",false,'Search');
--></script>
<div id="top">
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">Bitcoin&#160;<span id="projectnumber">1.0</span></div>
   <div id="projectbrief">Bitcoin port</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li id="searchli">
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
<div class="header">
  <div class="headertitle">
<div class="title">Object/Message/Block.c</div>  </div>
</div>
<div class="contents">
<a href="_m_i_block_8c.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/*</span>
<a name="l00002"></a>00002 <span class="comment"> * Block.c</span>
<a name="l00003"></a>00003 <span class="comment"> *</span>
<a name="l00004"></a>00004 <span class="comment"> *  Created on: 04/10/2012</span>
<a name="l00005"></a>00005 <span class="comment"> *  Created by: Wen Shen</span>
<a name="l00006"></a>00006 <span class="comment"> *  Copyright (c) 2012 Bitcoin Project Team</span>
<a name="l00007"></a>00007 <span class="comment"> */</span>
<a name="l00008"></a>00008 
<a name="l00009"></a>00009 <span class="preprocessor">#include &quot;<a class="code" href="_m_i_block_8h.html">Block.h</a>&quot;</span>
<a name="l00010"></a>00010 <span class="preprocessor">#include &quot;assert.h&quot;</span>
<a name="l00011"></a>00011 <span class="preprocessor">#include &quot;../ByteArray.h&quot;</span>
<a name="l00012"></a>00012 <span class="preprocessor">#include &quot;ctype.h&quot;</span>
<a name="l00013"></a>00013 <span class="preprocessor">#include &quot;../../Utils/VariableLengthInteger/VarLenInt.h&quot;</span>
<a name="l00014"></a>00014 <span class="preprocessor">#include &quot;<a class="code" href="_m_i_transaction_8h.html">Transaction.h</a>&quot;</span>
<a name="l00015"></a>00015 <span class="preprocessor">#include &quot;../../Utils/Cryptography/Crypt.h&quot;</span>
<a name="l00016"></a>00016 <span class="preprocessor">#include &quot;<a class="code" href="_m_i_message_8h.html">Message.h</a>&quot;</span>
<a name="l00017"></a>00017 
<a name="l00021"></a><a class="code" href="_m_i_block_8h.html#a32a782c3e422cc5b132abaddc4eecf13">00021</a> <a class="code" href="struct_m_i_block.html">Block</a> * <a class="code" href="_m_i_block_8c.html#a32a782c3e422cc5b132abaddc4eecf13" title="Creates a new Block object. Set the members after creating the block object.">createNewBlock</a>(<span class="keywordtype">void</span>(*onErrorReceived)(<a class="code" href="_m_i_constants_8h.html#a78789cd8e7333545dd73768531261968">Error</a> error, <span class="keywordtype">char</span> *, ...)) {
<a name="l00022"></a>00022         <a class="code" href="struct_m_i_block.html">Block</a> * <span class="keyword">self</span> = malloc(<span class="keyword">sizeof</span>(*<span class="keyword">self</span>));
<a name="l00023"></a>00023         assert(onErrorReceived != NULL);
<a name="l00024"></a>00024         <span class="keywordflow">if</span> (!<span class="keyword">self</span>) {
<a name="l00025"></a>00025                 onErrorReceived(<a class="code" href="_m_i_constants_8h.html#a78789cd8e7333545dd73768531261968ad4cc7a4523a7fd575f8d7ae42d20087f">_ERROR_OUT_OF_MEMORY</a>,
<a name="l00026"></a>00026                                 <span class="stringliteral">&quot;Cannot allocate %i bytes of memory in createNewBlock\n&quot;</span>,
<a name="l00027"></a>00027                                 <span class="keyword">sizeof</span>(*<span class="keyword">self</span>));
<a name="l00028"></a>00028                 <span class="keywordflow">return</span> NULL;
<a name="l00029"></a>00029         }
<a name="l00030"></a>00030         <a class="code" href="_m_i_object_8c.html#a0f72e3416dc7f6c52cfb1bf49baac3f2" title="Casts the pointer to the Object; use this to avoid explicitly casting.">getObject</a>(<span class="keyword">self</span>)-&gt;<a class="code" href="struct_m_i_object.html#aa353725933e843001d4feb03f8268121">destroy</a> = <a class="code" href="_m_i_block_8c.html#a89f003068369d45ffd1c8af41cfadf72" title="Frees a Block object.">deleteBlock</a>;
<a name="l00031"></a>00031         <span class="keywordtype">int</span> isSuccessful = <a class="code" href="_m_i_block_8c.html#aff02edfeca99bc15719c64dbc47eb7ba" title="Initializes a Block object.">initBlock</a>(<span class="keyword">self</span>, onErrorReceived);
<a name="l00032"></a>00032         <span class="keywordflow">if</span> (isSuccessful) {
<a name="l00033"></a>00033                 <span class="keywordflow">return</span> <span class="keyword">self</span>; <span class="comment">/* created successfully */</span>
<a name="l00034"></a>00034         }
<a name="l00035"></a>00035         free(<span class="keyword">self</span>); <span class="comment">/*free the memory */</span>
<a name="l00036"></a>00036         <span class="keywordflow">return</span> NULL;
<a name="l00037"></a>00037 }
<a name="l00041"></a><a class="code" href="_m_i_block_8h.html#aaddeaac51a35b3b98ade3340b6d46bac">00041</a> <a class="code" href="struct_m_i_block.html">Block</a> * <a class="code" href="_m_i_block_8c.html#aaddeaac51a35b3b98ade3340b6d46bac" title="Creates a new Block object from serialized block data.">createNewBlockFromByteArray</a>(<a class="code" href="struct_m_i_byte_array.html" title="Structure for ByteArray objects.">ByteArray</a> * data,
<a name="l00042"></a>00042                 <span class="keywordtype">void</span>(*onErrorReceived)(<a class="code" href="_m_i_constants_8h.html#a78789cd8e7333545dd73768531261968">Error</a> error, <span class="keywordtype">char</span> *, ...)) {
<a name="l00043"></a>00043         assert(data != NULL);
<a name="l00044"></a>00044         assert(onErrorReceived != NULL);
<a name="l00045"></a>00045         <a class="code" href="struct_m_i_block.html">Block</a> * <span class="keyword">self</span> = malloc(<span class="keyword">sizeof</span>(*<span class="keyword">self</span>));
<a name="l00046"></a>00046         <span class="keywordflow">if</span> (!<span class="keyword">self</span>) {
<a name="l00047"></a>00047                 onErrorReceived(
<a name="l00048"></a>00048                                 <a class="code" href="_m_i_constants_8h.html#a78789cd8e7333545dd73768531261968ad4cc7a4523a7fd575f8d7ae42d20087f">_ERROR_OUT_OF_MEMORY</a>,
<a name="l00049"></a>00049                                 <span class="stringliteral">&quot;Cannot allocate %i bytes of memory in createNewBlockFromByteArray\n&quot;</span>,
<a name="l00050"></a>00050                                 <span class="keyword">sizeof</span>(*<span class="keyword">self</span>));
<a name="l00051"></a>00051                 <span class="keywordflow">return</span> NULL;
<a name="l00052"></a>00052         }
<a name="l00053"></a>00053         <a class="code" href="_m_i_object_8c.html#a0f72e3416dc7f6c52cfb1bf49baac3f2" title="Casts the pointer to the Object; use this to avoid explicitly casting.">getObject</a>(<span class="keyword">self</span>)-&gt;<a class="code" href="struct_m_i_object.html#aa353725933e843001d4feb03f8268121">destroy</a> = <a class="code" href="_m_i_block_8c.html#a89f003068369d45ffd1c8af41cfadf72" title="Frees a Block object.">deleteBlock</a>;
<a name="l00054"></a>00054         <span class="keywordtype">int</span> isSuccessful = <a class="code" href="_m_i_block_8c.html#adb55432064c1fb591abf43542ed6261e" title="Initializes a Block object from serialized data.">initBlockFromByteArray</a>(<span class="keyword">self</span>, data, onErrorReceived);
<a name="l00055"></a>00055         <span class="keywordflow">if</span> (isSuccessful) {
<a name="l00056"></a>00056                 <span class="keywordflow">return</span> <span class="keyword">self</span>;
<a name="l00057"></a>00057         }
<a name="l00058"></a>00058         free(<span class="keyword">self</span>);
<a name="l00059"></a>00059         <span class="keywordflow">return</span> NULL;
<a name="l00060"></a>00060 }
<a name="l00064"></a><a class="code" href="_m_i_block_8c.html#a9eb01377cf0d49ddc3dd988d221ddd76">00064</a> <a class="code" href="struct_m_i_block.html">Block</a> * <a class="code" href="_m_i_block_8c.html#a9eb01377cf0d49ddc3dd988d221ddd76">createNewBlockFromOriginalBlock</a>(
<a name="l00065"></a>00065                 <span class="keywordtype">void</span>(*onErrorReceived)(<a class="code" href="_m_i_constants_8h.html#a78789cd8e7333545dd73768531261968">Error</a> error, <span class="keywordtype">char</span> *, ...)) {
<a name="l00066"></a>00066         <a class="code" href="struct_m_i_block.html">Block</a> * <span class="keyword">self</span> = malloc(<span class="keyword">sizeof</span>(*<span class="keyword">self</span>));
<a name="l00067"></a>00067         assert(onErrorReceived != NULL);
<a name="l00068"></a>00068         <span class="keywordflow">if</span> (!<span class="keyword">self</span>) {
<a name="l00069"></a>00069                 onErrorReceived(
<a name="l00070"></a>00070                                 <a class="code" href="_m_i_constants_8h.html#a78789cd8e7333545dd73768531261968ad4cc7a4523a7fd575f8d7ae42d20087f">_ERROR_OUT_OF_MEMORY</a>,
<a name="l00071"></a>00071                                 <span class="stringliteral">&quot;Cannot allocate %i bytes of memory in createNewBlockFromOriginalBlock\n&quot;</span>,
<a name="l00072"></a>00072                                 <span class="keyword">sizeof</span>(*<span class="keyword">self</span>));
<a name="l00073"></a>00073                 <span class="keywordflow">return</span> NULL;
<a name="l00074"></a>00074         }
<a name="l00075"></a>00075         <a class="code" href="_m_i_object_8c.html#a0f72e3416dc7f6c52cfb1bf49baac3f2" title="Casts the pointer to the Object; use this to avoid explicitly casting.">getObject</a>(<span class="keyword">self</span>)-&gt;<a class="code" href="struct_m_i_object.html#aa353725933e843001d4feb03f8268121">destroy</a> = <a class="code" href="_m_i_block_8c.html#a89f003068369d45ffd1c8af41cfadf72" title="Frees a Block object.">deleteBlock</a>;
<a name="l00076"></a>00076         <span class="keywordtype">int</span> isSuccessful = <a class="code" href="_m_i_block_8c.html#ab4caa099f720462b32d9e74406309b1d" title="Initializes a Block object with the original block for the bitcoin block chain. This will have seri...">initBlockWithOriginalBlock</a>(<span class="keyword">self</span>, onErrorReceived);
<a name="l00077"></a>00077         <span class="keywordflow">if</span> (isSuccessful) {
<a name="l00078"></a>00078                 <span class="keywordflow">return</span> <span class="keyword">self</span>;
<a name="l00079"></a>00079         }
<a name="l00080"></a>00080         free(<span class="keyword">self</span>);
<a name="l00081"></a>00081         <span class="keywordflow">return</span> NULL;
<a name="l00082"></a>00082 }
<a name="l00083"></a>00083 
<a name="l00088"></a><a class="code" href="_m_i_block_8h.html#ad48f71d612a4ef0e4e691549b8e4530e">00088</a> <a class="code" href="struct_m_i_block.html">Block</a> * <a class="code" href="_m_i_block_8c.html#ad48f71d612a4ef0e4e691549b8e4530e" title="Gets a Block from another object. Use this to avoid casts.">getBlock</a>(<span class="keywordtype">void</span> * <span class="keyword">self</span>) {
<a name="l00089"></a>00089         assert(<span class="keyword">self</span>!= NULL);
<a name="l00090"></a>00090         <span class="keywordflow">return</span> <span class="keyword">self</span>;
<a name="l00091"></a>00091 }
<a name="l00092"></a>00092 
<a name="l00097"></a><a class="code" href="_m_i_block_8h.html#aff02edfeca99bc15719c64dbc47eb7ba">00097</a> <span class="keywordtype">int</span> <a class="code" href="_m_i_block_8c.html#aff02edfeca99bc15719c64dbc47eb7ba" title="Initializes a Block object.">initBlock</a>(<a class="code" href="struct_m_i_block.html">Block</a> * <span class="keyword">self</span>,
<a name="l00098"></a>00098                 <span class="keywordtype">void</span>(*onErrorReceived)(<a class="code" href="_m_i_constants_8h.html#a78789cd8e7333545dd73768531261968">Error</a> error, <span class="keywordtype">char</span> *, ...)) {
<a name="l00099"></a>00099         assert(<span class="keyword">self</span>!= NULL);
<a name="l00100"></a>00100         assert(onErrorReceived != NULL);
<a name="l00101"></a>00101         <span class="keyword">self</span>-&gt;previousBlockHash = NULL;
<a name="l00102"></a>00102         <span class="keyword">self</span>-&gt;merkleTreeRootHash = NULL;
<a name="l00103"></a>00103         <span class="keyword">self</span>-&gt;transactions = NULL;
<a name="l00104"></a>00104         <span class="keyword">self</span>-&gt;numOfTransactions = 0;
<a name="l00105"></a>00105         <span class="keywordtype">int</span> isSuccessful = initializeMessage(<a class="code" href="_m_i_message_8c.html#a5b1bc10a9354d0ad365fc55123dba947" title="Gets a Message from another object. Use this to avoid casts.">getMessage</a>(<span class="keyword">self</span>), onErrorReceived);
<a name="l00106"></a>00106         <span class="keywordflow">if</span> (isSuccessful){
<a name="l00107"></a>00107                 <span class="keywordflow">return</span> <a class="code" href="_m_i_constants_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;
<a name="l00108"></a>00108         }<span class="keywordflow">else</span>{
<a name="l00109"></a>00109                 <span class="keywordflow">return</span> <a class="code" href="_m_i_constants_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;
<a name="l00110"></a>00110         }
<a name="l00111"></a>00111 
<a name="l00112"></a>00112 }
<a name="l00113"></a>00113 
<a name="l00117"></a><a class="code" href="_m_i_block_8h.html#adb55432064c1fb591abf43542ed6261e">00117</a> <span class="keywordtype">int</span> <a class="code" href="_m_i_block_8c.html#adb55432064c1fb591abf43542ed6261e" title="Initializes a Block object from serialized data.">initBlockFromByteArray</a>(<a class="code" href="struct_m_i_block.html">Block</a> * <span class="keyword">self</span>, <a class="code" href="struct_m_i_byte_array.html" title="Structure for ByteArray objects.">ByteArray</a> * data,
<a name="l00118"></a>00118                 <span class="keywordtype">void</span>(*onErrorReceived)(<a class="code" href="_m_i_constants_8h.html#a78789cd8e7333545dd73768531261968">Error</a> error, <span class="keywordtype">char</span> *, ...)) {
<a name="l00119"></a>00119         assert(<span class="keyword">self</span>!= NULL);
<a name="l00120"></a>00120         assert(onErrorReceived != NULL);
<a name="l00121"></a>00121         <span class="keyword">self</span>-&gt;previousBlockHash = NULL;
<a name="l00122"></a>00122         <span class="keyword">self</span>-&gt;merkleTreeRootHash = NULL;
<a name="l00123"></a>00123         <span class="keyword">self</span>-&gt;transactions = NULL;
<a name="l00124"></a>00124         <span class="keyword">self</span>-&gt;numOfTransactions = 0;
<a name="l00125"></a>00125         <span class="keywordtype">int</span> isSuccessful = initializeMessageFromByteArray(<a class="code" href="_m_i_message_8c.html#a5b1bc10a9354d0ad365fc55123dba947" title="Gets a Message from another object. Use this to avoid casts.">getMessage</a>(<span class="keyword">self</span>), data,
<a name="l00126"></a>00126                         onErrorReceived);
<a name="l00127"></a>00127         <span class="keywordflow">if</span> (isSuccessful){
<a name="l00128"></a>00128                 <span class="keywordflow">return</span> <a class="code" href="_m_i_constants_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;
<a name="l00129"></a>00129         }
<a name="l00130"></a>00130         <span class="keywordflow">return</span> <a class="code" href="_m_i_constants_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;
<a name="l00131"></a>00131 
<a name="l00132"></a>00132 }
<a name="l00133"></a><a class="code" href="_m_i_block_8h.html#ab4caa099f720462b32d9e74406309b1d">00133</a> <span class="keywordtype">int</span> <a class="code" href="_m_i_block_8c.html#ab4caa099f720462b32d9e74406309b1d" title="Initializes a Block object with the original block for the bitcoin block chain. This will have seri...">initBlockWithOriginalBlock</a>(<a class="code" href="struct_m_i_block.html">Block</a> * <span class="keyword">self</span>,<span class="keywordtype">void</span>(*onErrorReceived)(<a class="code" href="_m_i_constants_8h.html#a78789cd8e7333545dd73768531261968">Error</a> error, <span class="keywordtype">char</span> *, ...)) {
<a name="l00134"></a>00134         assert(<span class="keyword">self</span>!= NULL);
<a name="l00135"></a>00135         assert(onErrorReceived != NULL);
<a name="l00136"></a>00136         uint8_t uint_data[285] = {0x01,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x3B,0xA3,0xED,0xFD,0x7A,0x7B,0x12,0xB2,0x7A,0xC7,0x2C,0x3E,0x67,0x76,0x8F,0x61,0x7F,0xC8,0x1B,0xC3,0x88,0x8A,0x51,0x32,0x3A,0x9F,0xB8,0xAA,0x4B,0x1E,0x5E,0x4A,0x29,0xAB,0x5F,0x49,0xFF,0xFF,0x00,0x1D,0x1D,0xAC,0x2B,0x7C,0x01,0x01,0x00,0x00,0x00,0x01,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,0xFF,0xFF,0xFF,0x4D,0x04,0xFF,0xFF,0x00,0x1D,0x01,0x04,0x45,0x54,0x68,0x65,0x20,0x54,0x69,0x6D,0x65,0x73,0x20,0x30,0x33,0x2F,0x4A,0x61,0x6E,0x2F,0x32,0x30,0x30,0x39,0x20,0x43,0x68,0x61,0x6E,0x63,0x65,0x6C,0x6C,0x6F,0x72,0x20,0x6F,0x6E,0x20,0x62,0x72,0x69,0x6E,0x6B,0x20,0x6F,0x66,0x20,0x73,0x65,0x63,0x6F,0x6E,0x64,0x20,0x62,0x61,0x69,0x6C,0x6F,0x75,0x74,0x20,0x66,0x6F,0x72,0x20,0x62,0x61,0x6E,0x6B,0x73,0xFF,0xFF,0xFF,0xFF,0x01,0x00,0xF2,0x05,0x2A,0x01,0x00,0x00,0x00,0x43,0x41,0x04,0x67,0x8A,0xFD,0xB0,0xFE,0x55,0x48,0x27,0x19,0x67,0xF1,0xA6,0x71,0x30,0xB7,0x10,0x5C,0xD6,0xA8,0x28,0xE0,0x39,0x09,0xA6,0x79,0x62,0xE0,0xEA,0x1F,0x61,0xDE,0xB6,0x49,0xF6,0xBC,0x3F,0x4C,0xEF,0x38,0xC4,0xF3,0x55,0x04,0xE5,0x1E,0xC1,0x12,0xDE,0x5C,0x38,0x4D,0xF7,0xBA,0x0B,0x8D,0x57,0x8A,0x4C,0x70,0x2B,0x6B,0xF1,0x1D,0x5F,0xAC,0x00,0x00,0x00,0x00};
<a name="l00137"></a>00137 
<a name="l00138"></a>00138         <a class="code" href="struct_m_i_byte_array.html" title="Structure for ByteArray objects.">ByteArray</a> *data = <a class="code" href="_m_i_byte_array_8c.html#a9d079ea9294ff1dfc57d978c0d0402cf" title="Creates a new ByteArray using data which is copied.">createNewByteArrayUsingDataCopy</a>(uint_data, 285, onErrorReceived);
<a name="l00139"></a>00139         <span class="keywordflow">if</span> (! data){
<a name="l00140"></a>00140                 <span class="keywordflow">return</span> <a class="code" href="_m_i_constants_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;
<a name="l00141"></a>00141         }
<a name="l00142"></a>00142         uint8_t genesisHash[32] = {0x6F,0xE2,0x8C,0x0A,0xB6,0xF1,0xB3,0x72,0xC1,0xA6,0xA2,0x46,0xAE,0x63,0xF7,0x4F,0x93,0x1E,0x83,0x65,0xE1,0x5A,0x08,0x9C,0x68,0xD6,0x19,0x00,0x00,0x00,0x00,0x00};
<a name="l00143"></a>00143         memcpy(self-&gt;hash, genesisHash, 32);
<a name="l00144"></a>00144         <span class="keywordtype">int</span> isSuccessful = initializeMessageFromByteArray(<a class="code" href="_m_i_message_8c.html#a5b1bc10a9354d0ad365fc55123dba947" title="Gets a Message from another object. Use this to avoid casts.">getMessage</a>(<span class="keyword">self</span>), data, onErrorReceived);
<a name="l00145"></a>00145         <span class="keywordflow">if</span> (! isSuccessful) {
<a name="l00146"></a>00146                 <a class="code" href="_m_i_object_8c.html#a0407d34294cdc667982ffa9bd6f18cc9" title="Decrease the number in the reference counter. (It keeps track of how many objects have been created)...">decrementReferenceCount</a>(data); <span class="comment">/*Decrease the count of  the ByteArray data*/</span>
<a name="l00147"></a>00147                 <a class="code" href="_m_i_object_8c.html#a0407d34294cdc667982ffa9bd6f18cc9" title="Decrease the number in the reference counter. (It keeps track of how many objects have been created)...">decrementReferenceCount</a>(self-&gt;hash);<span class="comment">/*Decrease the count of the hash*/</span>
<a name="l00148"></a>00148                 <span class="keywordflow">return</span> <a class="code" href="_m_i_constants_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;
<a name="l00149"></a>00149         }
<a name="l00150"></a>00150         <a class="code" href="_m_i_object_8c.html#a0407d34294cdc667982ffa9bd6f18cc9" title="Decrease the number in the reference counter. (It keeps track of how many objects have been created)...">decrementReferenceCount</a>(data);<span class="comment">/*Decrease the count of  the ByteArray data*/</span>
<a name="l00151"></a>00151         <a class="code" href="_m_i_block_8c.html#a9b85a6f60672aea0471f7b6a7e9930ba" title="Deserializes a Block so that it can be used as an object.">deserializeBlock</a>(<span class="keyword">self</span>, <a class="code" href="_m_i_constants_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>);<span class="comment">/*Deserialize the Block so that it can be used as an object*/</span>
<a name="l00152"></a>00152         <span class="keywordflow">return</span> <a class="code" href="_m_i_constants_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;
<a name="l00153"></a>00153 }
<a name="l00154"></a>00154 
<a name="l00155"></a>00155 
<a name="l00159"></a><a class="code" href="_m_i_block_8h.html#a4dd7a61ea64a2b7cde840038ec14d2db">00159</a> <span class="keywordtype">void</span> <a class="code" href="_m_i_block_8c.html#a89f003068369d45ffd1c8af41cfadf72" title="Frees a Block object.">deleteBlock</a>(<span class="keywordtype">void</span> * selfCopy) {
<a name="l00160"></a>00160         assert(selfCopy != NULL);
<a name="l00161"></a>00161         <a class="code" href="struct_m_i_block.html">Block</a> * <span class="keyword">self</span> = selfCopy;
<a name="l00162"></a>00162 
<a name="l00163"></a>00163         <span class="comment">/*Destroy the previous Block hash*/</span>
<a name="l00164"></a>00164         <span class="keywordflow">if</span> (self-&gt;previousBlockHash) {
<a name="l00165"></a>00165                 <a class="code" href="_m_i_object_8c.html#a0407d34294cdc667982ffa9bd6f18cc9" title="Decrease the number in the reference counter. (It keeps track of how many objects have been created)...">decrementReferenceCount</a>(self-&gt;previousBlockHash);
<a name="l00166"></a>00166         }
<a name="l00167"></a>00167         <span class="comment">/*Destroy merkle Tree Root hash*/</span>
<a name="l00168"></a>00168         <span class="keywordflow">if</span> (self-&gt;merkleTreeRootHash) {
<a name="l00169"></a>00169                 <a class="code" href="_m_i_object_8c.html#a0407d34294cdc667982ffa9bd6f18cc9" title="Decrease the number in the reference counter. (It keeps track of how many objects have been created)...">decrementReferenceCount</a>(self-&gt;merkleTreeRootHash);
<a name="l00170"></a>00170         }
<a name="l00171"></a>00171         <span class="comment">/*Destroy transactions*/</span>
<a name="l00172"></a>00172         <span class="keywordflow">if</span> (self-&gt;transactions) { <span class="comment">/* Check for the loop since the transaction number can be set without having any transactions. */</span>
<a name="l00173"></a>00173                 uint32_t i;
<a name="l00174"></a>00174                 <span class="keywordflow">for</span> (i = 0; i &lt; <span class="keyword">self</span>-&gt;numOfTransactions; i++)
<a name="l00175"></a>00175                         <span class="keywordflow">if</span> (self-&gt;transactions[i])
<a name="l00176"></a>00176                                 <a class="code" href="_m_i_object_8c.html#a0407d34294cdc667982ffa9bd6f18cc9" title="Decrease the number in the reference counter. (It keeps track of how many objects have been created)...">decrementReferenceCount</a>(self-&gt;transactions[i]);
<a name="l00177"></a>00177                 free(self-&gt;transactions);
<a name="l00178"></a>00178         }
<a name="l00179"></a>00179         <span class="comment">/*Destroy hash*/</span>
<a name="l00180"></a>00180         <span class="keywordflow">if</span> (self-&gt;hash) {
<a name="l00181"></a>00181                 <a class="code" href="_m_i_object_8c.html#a0407d34294cdc667982ffa9bd6f18cc9" title="Decrease the number in the reference counter. (It keeps track of how many objects have been created)...">decrementReferenceCount</a>(self-&gt;hash);
<a name="l00182"></a>00182         }
<a name="l00183"></a>00183         <span class="comment">/*Destroy the Message base*/</span>
<a name="l00184"></a>00184         <a class="code" href="_m_i_message_8c.html#a17557bbd8e2e7b7d0736c88df25a389e" title="destroys the memory allocated to a Message object.">destroyMessage</a>(<a class="code" href="_m_i_object_8c.html#a0f72e3416dc7f6c52cfb1bf49baac3f2" title="Casts the pointer to the Object; use this to avoid explicitly casting.">getObject</a>(<span class="keyword">self</span>));
<a name="l00185"></a>00185 }
<a name="l00186"></a>00186 
<a name="l00191"></a><a class="code" href="_m_i_block_8h.html#a3913a1a3d961d7cc2c479de327337bae">00191</a> <span class="keywordtype">void</span> <a class="code" href="_m_i_block_8c.html#a3913a1a3d961d7cc2c479de327337bae" title="Calculates the hash for a block.">calculateBlockHash</a>(<a class="code" href="struct_m_i_block.html">Block</a> * <span class="keyword">self</span>, uint8_t * hash) {
<a name="l00192"></a>00192         assert(<span class="keyword">self</span>!=NULL &amp;&amp; hash != NULL);
<a name="l00193"></a>00193         uint8_t * headerData = <a class="code" href="_m_i_byte_array_8c.html#a29dc51ffba948226c028baf425096408" title="Get a pointer to the underlying data starting at self-&gt;offset.">getDataFromByteArray</a>(<a class="code" href="_m_i_message_8c.html#a5b1bc10a9354d0ad365fc55123dba947" title="Gets a Message from another object. Use this to avoid casts.">getMessage</a>(<span class="keyword">self</span>)-&gt;bytes);
<a name="l00194"></a>00194         uint8_t hash2[32];
<a name="l00195"></a>00195         <a class="code" href="_m_i_crypt_8c.html#ab62ec3041775f1d56093fa4096c2ef84" title="SHA-256 cryptographic hash function.">Sha256</a>(headerData, 80, hash2);
<a name="l00196"></a>00196         <a class="code" href="_m_i_crypt_8c.html#ab62ec3041775f1d56093fa4096c2ef84" title="SHA-256 cryptographic hash function.">Sha256</a>(hash2, 32, hash);
<a name="l00197"></a>00197 }
<a name="l00201"></a><a class="code" href="_m_i_block_8h.html#ab3c577ac4b13bc68f0ac3f82159969a6">00201</a> uint32_t <a class="code" href="_m_i_block_8c.html#ab3c577ac4b13bc68f0ac3f82159969a6" title="Calculates the length needed to serialize the object.">calculateBlockLength</a>(<a class="code" href="struct_m_i_block.html">Block</a> * <span class="keyword">self</span>, <span class="keywordtype">int</span> transactions) {
<a name="l00202"></a>00202         assert(<span class="keyword">self</span>!=NULL &amp;&amp; transactions != NULL);
<a name="l00203"></a>00203         uint32_t len = 80 + <a class="code" href="_m_i_var_len_int_8c.html#a960ae6b1a5365789aec7b7055a36dbd7" title="Returns the variable integer byte size of a 64 bit integer.">getSizeOfVarLenInt</a>(self-&gt;numOfTransactions);
<a name="l00204"></a>00204         <span class="comment">/*calculate TransactinLength*/</span>
<a name="l00205"></a>00205         <span class="keywordflow">if</span> (transactions) {
<a name="l00206"></a>00206                 uint32_t x;
<a name="l00207"></a>00207                 <span class="keywordflow">for</span> (x = 0; x &lt; <span class="keyword">self</span>-&gt;numOfTransactions; x++) {
<a name="l00208"></a>00208                         uint32_t tLen = <a class="code" href="_m_i_transaction_8c.html#a399ecdc9998cfe26c0f2a1928572b54b" title="Calculates the length of an Transaction; this is needed to serialise the object.">calculateTransactionLength</a>(self-&gt;transactions[x]);
<a name="l00209"></a>00209                         <span class="keywordflow">if</span> (!tLen)
<a name="l00210"></a>00210                                 <span class="keywordflow">return</span> 0;
<a name="l00211"></a>00211                         len += tLen;
<a name="l00212"></a>00212                 }
<a name="l00213"></a>00213                 <span class="keywordflow">return</span> len;
<a name="l00214"></a>00214         } <span class="keywordflow">else</span>
<a name="l00215"></a>00215                 <span class="keywordflow">return</span> len + 1; <span class="comment">/* Plus the stupid pointless null byte. */</span>
<a name="l00216"></a>00216 }
<a name="l00220"></a><a class="code" href="_m_i_block_8h.html#a9b85a6f60672aea0471f7b6a7e9930ba">00220</a> uint32_t <a class="code" href="_m_i_block_8c.html#a9b85a6f60672aea0471f7b6a7e9930ba" title="Deserializes a Block so that it can be used as an object.">deserializeBlock</a>(<a class="code" href="struct_m_i_block.html">Block</a> * <span class="keyword">self</span>, <span class="keywordtype">int</span> transactions) {
<a name="l00221"></a>00221         assert(<span class="keyword">self</span>!= NULL );
<a name="l00222"></a>00222         <span class="comment">/*Parameters checking*/</span>
<a name="l00223"></a>00223         assert(transactions != NULL &amp;&amp; !isalpha(transactions) &amp;&amp; transactions/1.00 == (<span class="keywordtype">int</span>) transactions);
<a name="l00224"></a>00224         <a class="code" href="struct_m_i_byte_array.html" title="Structure for ByteArray objects.">ByteArray</a> * bytes = <a class="code" href="_m_i_message_8c.html#a5b1bc10a9354d0ad365fc55123dba947" title="Gets a Message from another object. Use this to avoid casts.">getMessage</a>(<span class="keyword">self</span>)-&gt;<a class="code" href="struct_m_i_message.html#a8fb493ee3c32dd3a9fb29bc71c852f86">bytes</a>;
<a name="l00225"></a>00225         <span class="keywordflow">if</span> (!bytes) {
<a name="l00226"></a>00226                 <a class="code" href="_m_i_message_8c.html#a5b1bc10a9354d0ad365fc55123dba947" title="Gets a Message from another object. Use this to avoid casts.">getMessage</a>(<span class="keyword">self</span>)-&gt;<a class="code" href="struct_m_i_message.html#aeb0776cff292839518da5f5a48884fd9">onErrorReceived</a>(
<a name="l00227"></a>00227                                 <a class="code" href="_m_i_constants_8h.html#a78789cd8e7333545dd73768531261968a92f5f1cd8d49eb6264885735124551cf">_ERROR_MESSAGE_DESERIALISATION_NULL_BYTES</a>,
<a name="l00228"></a>00228                                 <span class="stringliteral">&quot;Attempting to deserialize a Block with no bytes.&quot;</span>);
<a name="l00229"></a>00229                 <span class="keywordflow">return</span> 0;
<a name="l00230"></a>00230         }
<a name="l00231"></a>00231         <span class="keywordflow">if</span> (bytes-&gt;<a class="code" href="struct_m_i_byte_array.html#aebb70c2aab3407a9f05334c47131a43b">length</a> &lt; 82) {
<a name="l00232"></a>00232                 <a class="code" href="_m_i_message_8c.html#a5b1bc10a9354d0ad365fc55123dba947" title="Gets a Message from another object. Use this to avoid casts.">getMessage</a>(<span class="keyword">self</span>)-&gt;<a class="code" href="struct_m_i_message.html#aeb0776cff292839518da5f5a48884fd9">onErrorReceived</a>(
<a name="l00233"></a>00233                                 <a class="code" href="_m_i_constants_8h.html#a78789cd8e7333545dd73768531261968abd324fa69626e40713b7c4e1e6eef9f9">_ERROR_MESSAGE_DESERIALISATION_BAD_BYTES</a>,
<a name="l00234"></a>00234                                 <span class="stringliteral">&quot;Attempting to deserialize a Block with less than 82 bytes. Minimum for header (With null byte).&quot;</span>);
<a name="l00235"></a>00235                 <span class="keywordflow">return</span> 0;
<a name="l00236"></a>00236         }
<a name="l00237"></a>00237         <span class="keyword">self</span>-&gt;version = <a class="code" href="_m_i_byte_array_8c.html#aab10685017fe16769d5b22c826ada9f8" title="Reads a 32 bit integer from a ByteArray as little-endian.">readInt32AsLittleEndianFromByteArray</a>(bytes, 0);
<a name="l00238"></a>00238         <span class="keyword">self</span>-&gt;previousBlockHash = <a class="code" href="_m_i_byte_array_8c.html#a22681d5a43566996273c64d34d669806" title="References a subsection of a ByteArray.">getByteArraySubsectionReference</a>(bytes, 4, 32);
<a name="l00239"></a>00239         <span class="keywordflow">if</span> (!self-&gt;previousBlockHash) {
<a name="l00240"></a>00240                 <a class="code" href="_m_i_message_8c.html#a5b1bc10a9354d0ad365fc55123dba947" title="Gets a Message from another object. Use this to avoid casts.">getMessage</a>(<span class="keyword">self</span>)-&gt;<a class="code" href="struct_m_i_message.html#aeb0776cff292839518da5f5a48884fd9">onErrorReceived</a>(<a class="code" href="_m_i_constants_8h.html#a78789cd8e7333545dd73768531261968ac44c4a273612af5ceabd09df473706f4">_ERROR_INIT_FAIL</a>,
<a name="l00241"></a>00241                                 <span class="stringliteral">&quot;Cannot create the previous block hash ByteArray in deserializeBlock.&quot;</span>);
<a name="l00242"></a>00242                 <span class="keywordflow">return</span> 0;
<a name="l00243"></a>00243         }
<a name="l00244"></a>00244         <span class="keyword">self</span>-&gt;merkleTreeRootHash = <a class="code" href="_m_i_byte_array_8c.html#a22681d5a43566996273c64d34d669806" title="References a subsection of a ByteArray.">getByteArraySubsectionReference</a>(bytes, 36, 32);
<a name="l00245"></a>00245         <span class="keywordflow">if</span> (!self-&gt;merkleTreeRootHash) {
<a name="l00246"></a>00246                 <a class="code" href="_m_i_message_8c.html#a5b1bc10a9354d0ad365fc55123dba947" title="Gets a Message from another object. Use this to avoid casts.">getMessage</a>(<span class="keyword">self</span>)-&gt;<a class="code" href="struct_m_i_message.html#aeb0776cff292839518da5f5a48884fd9">onErrorReceived</a>(<a class="code" href="_m_i_constants_8h.html#a78789cd8e7333545dd73768531261968ac44c4a273612af5ceabd09df473706f4">_ERROR_INIT_FAIL</a>,
<a name="l00247"></a>00247                                 <span class="stringliteral">&quot;Cannot create the merkleTree root ByteArray in deserializeBlock.&quot;</span>);
<a name="l00248"></a>00248                 <span class="keywordflow">return</span> 0;
<a name="l00249"></a>00249         }
<a name="l00250"></a>00250         <span class="keyword">self</span>-&gt;time = <a class="code" href="_m_i_byte_array_8c.html#aab10685017fe16769d5b22c826ada9f8" title="Reads a 32 bit integer from a ByteArray as little-endian.">readInt32AsLittleEndianFromByteArray</a>(bytes, 68);
<a name="l00251"></a>00251         <span class="keyword">self</span>-&gt;target = <a class="code" href="_m_i_byte_array_8c.html#aab10685017fe16769d5b22c826ada9f8" title="Reads a 32 bit integer from a ByteArray as little-endian.">readInt32AsLittleEndianFromByteArray</a>(bytes, 72);
<a name="l00252"></a>00252         <span class="keyword">self</span>-&gt;nonce = <a class="code" href="_m_i_byte_array_8c.html#aab10685017fe16769d5b22c826ada9f8" title="Reads a 32 bit integer from a ByteArray as little-endian.">readInt32AsLittleEndianFromByteArray</a>(bytes, 76);
<a name="l00253"></a>00253         <span class="comment">/* If first VarLenInt byte is zero, then stop here for headers, otherwise look for 8 more bytes and continue */</span>
<a name="l00254"></a>00254         uint8_t firstByte = <a class="code" href="_m_i_byte_array_8c.html#af0eafd008dc71865431262ed1e29b4f2" title="Get a byte from the ByteArray object. A byte will be returned from self-&gt;offset+index in the underl...">getByteFromByteArray</a>(bytes, 80);
<a name="l00255"></a>00255         <span class="keywordflow">if</span> (transactions &amp;&amp; firstByte) {
<a name="l00256"></a>00256                  <a class="code" href="_m_i_block_8c.html#a04d2d2defba76492762c0eb4b7ccd206">deserializeWithTransactions</a>(<span class="keyword">self</span>,bytes);
<a name="l00257"></a>00257         } <span class="keywordflow">else</span> { <span class="comment">/* Just header*/</span>
<a name="l00258"></a>00258                 <a class="code" href="_m_i_block_8c.html#a292775bd99c32b5b2f51b8d71d10812e">deserializeWithOnlyHeaders</a>(<span class="keyword">self</span>, firstByte, bytes);
<a name="l00259"></a>00259         }
<a name="l00260"></a>00260 }
<a name="l00261"></a><a class="code" href="_m_i_block_8h.html#a04d2d2defba76492762c0eb4b7ccd206">00261</a> uint32_t <a class="code" href="_m_i_block_8c.html#a04d2d2defba76492762c0eb4b7ccd206">deserializeWithTransactions</a> (<a class="code" href="struct_m_i_block.html">Block</a> * <span class="keyword">self</span>, <a class="code" href="struct_m_i_byte_array.html" title="Structure for ByteArray objects.">ByteArray</a> * bytes){
<a name="l00262"></a>00262         assert(<span class="keyword">self</span>!= NULL &amp;&amp; bytes != NULL);
<a name="l00263"></a>00263         <span class="keywordflow">if</span> (bytes-&gt;<a class="code" href="struct_m_i_byte_array.html#aebb70c2aab3407a9f05334c47131a43b">length</a> &lt; 89) {
<a name="l00264"></a>00264                 <a class="code" href="_m_i_message_8c.html#a5b1bc10a9354d0ad365fc55123dba947" title="Gets a Message from another object. Use this to avoid casts.">getMessage</a>(<span class="keyword">self</span>)-&gt;<a class="code" href="struct_m_i_message.html#aeb0776cff292839518da5f5a48884fd9">onErrorReceived</a>(
<a name="l00265"></a>00265                                 <a class="code" href="_m_i_constants_8h.html#a78789cd8e7333545dd73768531261968abd324fa69626e40713b7c4e1e6eef9f9">_ERROR_MESSAGE_DESERIALISATION_BAD_BYTES</a>,
<a name="l00266"></a>00266                                 <span class="stringliteral">&quot;Attempting to deserialize a Block with a non-zero varint with less than 89 bytes.&quot;</span>);
<a name="l00267"></a>00267                 <span class="keywordflow">return</span> 0;
<a name="l00268"></a>00268         }
<a name="l00269"></a>00269         <a class="code" href="struct_m_i_var_len_int.html" title="Variable length integer specified in Bitcoin protocol.">VarLenInt</a> numOfTransactionsVarInt = <a class="code" href="_m_i_var_len_int_8c.html#a0492e373e2d12e41b1764b580f287af9" title="Decodes variable size integer from bytes into a VarLenInt structure.">decodeVarLenInt</a>(bytes, 80);
<a name="l00270"></a>00270         <span class="keywordflow">if</span> (numOfTransactionsVarInt.<a class="code" href="struct_m_i_var_len_int.html#a4e630859cc0e2a22bd6acf39a6a8e218">value</a> * 60 &gt; bytes-&gt;<a class="code" href="struct_m_i_byte_array.html#aebb70c2aab3407a9f05334c47131a43b">length</a> - 81) {
<a name="l00271"></a>00271                 <a class="code" href="_m_i_message_8c.html#a5b1bc10a9354d0ad365fc55123dba947" title="Gets a Message from another object. Use this to avoid casts.">getMessage</a>(<span class="keyword">self</span>)-&gt;<a class="code" href="struct_m_i_message.html#aeb0776cff292839518da5f5a48884fd9">onErrorReceived</a>(
<a name="l00272"></a>00272                                 <a class="code" href="_m_i_constants_8h.html#a78789cd8e7333545dd73768531261968abd324fa69626e40713b7c4e1e6eef9f9">_ERROR_MESSAGE_DESERIALISATION_BAD_BYTES</a>,
<a name="l00273"></a>00273                                 <span class="stringliteral">&quot;Attempting to deserialize a Block with too many transactions for the byte data length.&quot;</span>);
<a name="l00274"></a>00274                 <span class="keywordflow">return</span> 0;
<a name="l00275"></a>00275         }
<a name="l00276"></a>00276         <span class="keyword">self</span>-&gt;numOfTransactions = (uint32_t) numOfTransactionsVarInt.<a class="code" href="struct_m_i_var_len_int.html#a4e630859cc0e2a22bd6acf39a6a8e218">value</a>;
<a name="l00277"></a>00277         self-&gt;transactions = malloc(
<a name="l00278"></a>00278                         <span class="keyword">sizeof</span>(*self-&gt;transactions) * <span class="keyword">self</span>-&gt;numOfTransactions);
<a name="l00279"></a>00279         <span class="keywordflow">if</span> (!self-&gt;numOfTransactions) {
<a name="l00280"></a>00280                 <a class="code" href="_m_i_message_8c.html#a5b1bc10a9354d0ad365fc55123dba947" title="Gets a Message from another object. Use this to avoid casts.">getMessage</a>(<span class="keyword">self</span>)-&gt;<a class="code" href="struct_m_i_message.html#aeb0776cff292839518da5f5a48884fd9">onErrorReceived</a>(
<a name="l00281"></a>00281                                 <a class="code" href="_m_i_constants_8h.html#a78789cd8e7333545dd73768531261968ad4cc7a4523a7fd575f8d7ae42d20087f">_ERROR_OUT_OF_MEMORY</a>,
<a name="l00282"></a>00282                                 <span class="stringliteral">&quot;Cannot allocate %i bytes of memory in deserializeWithTransactions\n&quot;</span>,
<a name="l00283"></a>00283                                 <span class="keyword">sizeof</span>(*self-&gt;transactions) * self-&gt;numOfTransactions);
<a name="l00284"></a>00284                 <span class="keywordflow">return</span> 0;
<a name="l00285"></a>00285         }
<a name="l00286"></a>00286         uint32_t cursor = 80 + numOfTransactionsVarInt.<a class="code" href="struct_m_i_var_len_int.html#af922c72fe1d5915971491918ff5f923e">storageSize</a>;
<a name="l00287"></a>00287         uint16_t i;
<a name="l00288"></a>00288         <span class="keywordflow">for</span> (i = 0; i &lt; <span class="keyword">self</span>-&gt;numOfTransactions; i++) {
<a name="l00289"></a>00289                 <a class="code" href="struct_m_i_byte_array.html" title="Structure for ByteArray objects.">ByteArray</a> * data = <a class="code" href="_m_i_byte_array_8c.html#a22681d5a43566996273c64d34d669806" title="References a subsection of a ByteArray.">getByteArraySubsectionReference</a>(bytes,
<a name="l00290"></a>00290                                 cursor, bytes-&gt;<a class="code" href="struct_m_i_byte_array.html#aebb70c2aab3407a9f05334c47131a43b">length</a> - cursor);
<a name="l00291"></a>00291                 <span class="keywordflow">if</span> (!data) {
<a name="l00292"></a>00292                         <a class="code" href="_m_i_message_8c.html#a5b1bc10a9354d0ad365fc55123dba947" title="Gets a Message from another object. Use this to avoid casts.">getMessage</a>(<span class="keyword">self</span>)-&gt;<a class="code" href="struct_m_i_message.html#aeb0776cff292839518da5f5a48884fd9">onErrorReceived</a>(
<a name="l00293"></a>00293                                         <a class="code" href="_m_i_constants_8h.html#a78789cd8e7333545dd73768531261968ac44c4a273612af5ceabd09df473706f4">_ERROR_INIT_FAIL</a>,
<a name="l00294"></a>00294                                         <span class="stringliteral">&quot;Could not create a new ByteArray in deserializeWithTransactions for the transaction number %u.&quot;</span>,
<a name="l00295"></a>00295                                         i);
<a name="l00296"></a>00296                 }
<a name="l00297"></a>00297                 <a class="code" href="struct_m_i_transaction.html" title="Structure for Transaction objects.">Transaction</a> * transaction =
<a name="l00298"></a>00298                                 <a class="code" href="_m_i_transaction_8c.html#ac64b350eebd0ac111556c9323025a5bc" title="Creates a new Transaction object from byte data. Should be serialised for object data...">createNewTransactionFromByteArray</a>(data,
<a name="l00299"></a>00299                                                 <a class="code" href="_m_i_message_8c.html#a5b1bc10a9354d0ad365fc55123dba947" title="Gets a Message from another object. Use this to avoid casts.">getMessage</a>(<span class="keyword">self</span>)-&gt;onErrorReceived);
<a name="l00300"></a>00300                 <span class="keywordflow">if</span> (!transaction) {
<a name="l00301"></a>00301                         <a class="code" href="_m_i_message_8c.html#a5b1bc10a9354d0ad365fc55123dba947" title="Gets a Message from another object. Use this to avoid casts.">getMessage</a>(<span class="keyword">self</span>)-&gt;<a class="code" href="struct_m_i_message.html#aeb0776cff292839518da5f5a48884fd9">onErrorReceived</a>(
<a name="l00302"></a>00302                                         <a class="code" href="_m_i_constants_8h.html#a78789cd8e7333545dd73768531261968ac44c4a273612af5ceabd09df473706f4">_ERROR_INIT_FAIL</a>,
<a name="l00303"></a>00303                                         <span class="stringliteral">&quot;Could not create a new Transaction in deserializeWithTransactions for the transaction number %u.&quot;</span>,
<a name="l00304"></a>00304                                         i);
<a name="l00305"></a>00305                         <a class="code" href="_m_i_object_8c.html#a0407d34294cdc667982ffa9bd6f18cc9" title="Decrease the number in the reference counter. (It keeps track of how many objects have been created)...">decrementReferenceCount</a>(data);
<a name="l00306"></a>00306                         <span class="keywordflow">return</span> 0;
<a name="l00307"></a>00307                 }
<a name="l00308"></a>00308                 uint32_t len = <a class="code" href="_m_i_transaction_8c.html#a8777f695fbbb547e32b9c0347b6b2026" title="Deserialises a Transaction so that it can be used as an object.">deserializeTransaction</a>(transaction);
<a name="l00309"></a>00309                 <span class="keywordflow">if</span> (!len) {
<a name="l00310"></a>00310                         <a class="code" href="_m_i_message_8c.html#a5b1bc10a9354d0ad365fc55123dba947" title="Gets a Message from another object. Use this to avoid casts.">getMessage</a>(<span class="keyword">self</span>)-&gt;<a class="code" href="struct_m_i_message.html#aeb0776cff292839518da5f5a48884fd9">onErrorReceived</a>(
<a name="l00311"></a>00311                                         <a class="code" href="_m_i_constants_8h.html#a78789cd8e7333545dd73768531261968abd324fa69626e40713b7c4e1e6eef9f9">_ERROR_MESSAGE_DESERIALISATION_BAD_BYTES</a>,
<a name="l00312"></a>00312                                         <span class="stringliteral">&quot;Block cannot be deserialized because of an error with the transaction number %u.&quot;</span>,
<a name="l00313"></a>00313                                         i);
<a name="l00314"></a>00314                         <a class="code" href="_m_i_object_8c.html#a0407d34294cdc667982ffa9bd6f18cc9" title="Decrease the number in the reference counter. (It keeps track of how many objects have been created)...">decrementReferenceCount</a>(data);
<a name="l00315"></a>00315                         <span class="keywordflow">return</span> 0;
<a name="l00316"></a>00316                 }
<a name="l00317"></a>00317                 <span class="comment">/* Readjust ByteArray length */</span>
<a name="l00318"></a>00318                 data-&gt;<a class="code" href="struct_m_i_byte_array.html#aebb70c2aab3407a9f05334c47131a43b">length</a> = len;
<a name="l00319"></a>00319                 <a class="code" href="_m_i_object_8c.html#a0407d34294cdc667982ffa9bd6f18cc9" title="Decrease the number in the reference counter. (It keeps track of how many objects have been created)...">decrementReferenceCount</a>(data);
<a name="l00320"></a>00320                 <span class="keyword">self</span>-&gt;transactions[i] = transaction;
<a name="l00321"></a>00321                 cursor += len;
<a name="l00322"></a>00322         }
<a name="l00323"></a>00323                         <span class="keywordflow">return</span> cursor;
<a name="l00324"></a>00324 }
<a name="l00325"></a>00325 
<a name="l00326"></a><a class="code" href="_m_i_block_8h.html#a292775bd99c32b5b2f51b8d71d10812e">00326</a> uint32_t <a class="code" href="_m_i_block_8c.html#a292775bd99c32b5b2f51b8d71d10812e">deserializeWithOnlyHeaders</a>(<a class="code" href="struct_m_i_block.html">Block</a> * <span class="keyword">self</span>, uint8_t firstByte, <a class="code" href="struct_m_i_byte_array.html" title="Structure for ByteArray objects.">ByteArray</a> * bytes){
<a name="l00327"></a>00327         assert(<span class="keyword">self</span>!= NULL &amp;&amp; firstByte != NULL &amp;&amp; bytes!=NULL);
<a name="l00328"></a>00328         uint8_t i;
<a name="l00329"></a>00329         <span class="keywordflow">if</span> (firstByte &lt; 253) {
<a name="l00330"></a>00330                 i = 1;
<a name="l00331"></a>00331         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (firstByte == 253) {
<a name="l00332"></a>00332                 i = 2;
<a name="l00333"></a>00333         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (firstByte == 254) {
<a name="l00334"></a>00334                 i = 4;
<a name="l00335"></a>00335         } <span class="keywordflow">else</span> {
<a name="l00336"></a>00336                 i = 8;
<a name="l00337"></a>00337         }
<a name="l00338"></a>00338         <span class="keywordflow">if</span> (bytes-&gt;<a class="code" href="struct_m_i_byte_array.html#aebb70c2aab3407a9f05334c47131a43b">length</a> &lt; 80 + i + 1) {
<a name="l00339"></a>00339                 <a class="code" href="_m_i_message_8c.html#a5b1bc10a9354d0ad365fc55123dba947" title="Gets a Message from another object. Use this to avoid casts.">getMessage</a>(<span class="keyword">self</span>)-&gt;<a class="code" href="struct_m_i_message.html#aeb0776cff292839518da5f5a48884fd9">onErrorReceived</a>(
<a name="l00340"></a>00340                                 <a class="code" href="_m_i_constants_8h.html#a78789cd8e7333545dd73768531261968abd324fa69626e40713b7c4e1e6eef9f9">_ERROR_MESSAGE_DESERIALISATION_BAD_BYTES</a>,
<a name="l00341"></a>00341                                 <span class="stringliteral">&quot;Attempting to deserialize a Block header with not enough space to cover the var int.&quot;</span>);
<a name="l00342"></a>00342                 <span class="keywordflow">return</span> 0;
<a name="l00343"></a>00343         }
<a name="l00344"></a>00344         <span class="keyword">self</span>-&gt;numOfTransactions = (uint32_t) <a class="code" href="_m_i_var_len_int_8c.html#a0492e373e2d12e41b1764b580f287af9" title="Decodes variable size integer from bytes into a VarLenInt structure.">decodeVarLenInt</a>(bytes, 80).<a class="code" href="struct_m_i_var_len_int.html#a4e630859cc0e2a22bd6acf39a6a8e218">value</a>; <span class="comment">/* This value is undefined in the protocol. Should best be zero when getting the headers since there is not supposed to be any transactions. Would have probably been better if the var int was dropped completely for headers only.*/</span>
<a name="l00345"></a>00345         <span class="comment">/* Ensure null byte is null. This null byte is a bit of a nuissance but it exists in the protocol when there are no transactions. */</span>
<a name="l00346"></a>00346         <span class="keywordflow">if</span> (<a class="code" href="_m_i_byte_array_8c.html#af0eafd008dc71865431262ed1e29b4f2" title="Get a byte from the ByteArray object. A byte will be returned from self-&gt;offset+index in the underl...">getByteFromByteArray</a>(bytes, 80 + i) != 0) {
<a name="l00347"></a>00347                 <a class="code" href="_m_i_message_8c.html#a5b1bc10a9354d0ad365fc55123dba947" title="Gets a Message from another object. Use this to avoid casts.">getMessage</a>(<span class="keyword">self</span>)-&gt;<a class="code" href="struct_m_i_message.html#aeb0776cff292839518da5f5a48884fd9">onErrorReceived</a>(
<a name="l00348"></a>00348                                 <a class="code" href="_m_i_constants_8h.html#a78789cd8e7333545dd73768531261968abd324fa69626e40713b7c4e1e6eef9f9">_ERROR_MESSAGE_DESERIALISATION_BAD_BYTES</a>,
<a name="l00349"></a>00349                                 <span class="stringliteral">&quot;Attempting to deserialize a Block header with a final byte which is not null. This is not what it is supposed to be but you already knew that right?&quot;</span>);
<a name="l00350"></a>00350                 <span class="keywordflow">return</span> 0;
<a name="l00351"></a>00351         }
<a name="l00352"></a>00352         <span class="keywordflow">return</span> 80 + i + 1; <span class="comment">/* 80 header bytes, the var int and the null byte */</span>
<a name="l00353"></a>00353 }
<a name="l00354"></a>00354 
<a name="l00358"></a><a class="code" href="_m_i_block_8h.html#ae70cfa84a85cccf1f7a669a04acd82ce">00358</a> uint8_t * <a class="code" href="_m_i_block_8c.html#ae70cfa84a85cccf1f7a669a04acd82ce" title="Retrieves or calculates the hash for a block. Hashes taken from this function are cached...">getBlockHash</a>(<a class="code" href="struct_m_i_block.html">Block</a> * <span class="keyword">self</span>) {
<a name="l00359"></a>00359         assert(<span class="keyword">self</span> != NULL);
<a name="l00360"></a>00360         <span class="keywordflow">if</span> (!self-&gt;hash)
<a name="l00361"></a>00361                 <a class="code" href="_m_i_block_8c.html#a3913a1a3d961d7cc2c479de327337bae" title="Calculates the hash for a block.">calculateBlockHash</a>(<span class="keyword">self</span>, self-&gt;hash);
<a name="l00362"></a>00362         <span class="keywordflow">return</span> <span class="keyword">self</span>-&gt;hash;
<a name="l00363"></a>00363 }
<a name="l00364"></a>00364 
<a name="l00365"></a>00365 <span class="comment">/*</span>
<a name="l00366"></a>00366 <span class="comment"> * Serialize Block</span>
<a name="l00367"></a>00367 <span class="comment"> */</span>
<a name="l00368"></a><a class="code" href="_m_i_block_8h.html#a3dab3fff46c9b386501414a6b13f5192">00368</a> uint32_t <a class="code" href="_m_i_block_8c.html#a3dab3fff46c9b386501414a6b13f5192" title="Serializes a Block to the byte data.">serializeBlock</a>(<a class="code" href="struct_m_i_block.html">Block</a> * <span class="keyword">self</span>, <span class="keywordtype">int</span> transactions) {
<a name="l00369"></a>00369         assert(<span class="keyword">self</span>!= NULL );
<a name="l00370"></a>00370         assert(transactions != NULL &amp;&amp; !isalpha(transactions) &amp;&amp; transactions/1.00 == (<span class="keywordtype">int</span>) transactions);
<a name="l00371"></a>00371         <a class="code" href="struct_m_i_byte_array.html" title="Structure for ByteArray objects.">ByteArray</a> * bytes = <a class="code" href="_m_i_message_8c.html#a5b1bc10a9354d0ad365fc55123dba947" title="Gets a Message from another object. Use this to avoid casts.">getMessage</a>(<span class="keyword">self</span>)-&gt;<a class="code" href="struct_m_i_message.html#a8fb493ee3c32dd3a9fb29bc71c852f86">bytes</a>;
<a name="l00372"></a>00372         <span class="keywordflow">if</span> (!bytes) {
<a name="l00373"></a>00373                 <a class="code" href="_m_i_message_8c.html#a5b1bc10a9354d0ad365fc55123dba947" title="Gets a Message from another object. Use this to avoid casts.">getMessage</a>(<span class="keyword">self</span>)-&gt;<a class="code" href="struct_m_i_message.html#aeb0776cff292839518da5f5a48884fd9">onErrorReceived</a>(
<a name="l00374"></a>00374                                 <a class="code" href="_m_i_constants_8h.html#a78789cd8e7333545dd73768531261968ac8ae144568e5761507c7d026a2531875">_ERROR_MESSAGE_SERIALISATION_NULL_BYTES</a>,
<a name="l00375"></a>00375                                 <span class="stringliteral">&quot;Attempting to serialise a Block with no bytes.&quot;</span>);
<a name="l00376"></a>00376                 <span class="keywordflow">return</span> 0;
<a name="l00377"></a>00377         }
<a name="l00378"></a>00378         <a class="code" href="struct_m_i_var_len_int.html" title="Variable length integer specified in Bitcoin protocol.">VarLenInt</a> numOfTransactions = <a class="code" href="_m_i_var_len_int_8c.html#ab415150158b7af4b63eb360b384b5ec0" title="Returns a variable integer from an unsigned 64 bit integer.">createVarLenIntFromUInt64</a>(
<a name="l00379"></a>00379                         self-&gt;numOfTransactions);
<a name="l00380"></a>00380         uint32_t cursor = 80 + numOfTransactions.<a class="code" href="struct_m_i_var_len_int.html#af922c72fe1d5915971491918ff5f923e">storageSize</a>;
<a name="l00381"></a>00381         <span class="keywordflow">if</span> (bytes-&gt;<a class="code" href="struct_m_i_byte_array.html#aebb70c2aab3407a9f05334c47131a43b">length</a> &lt; cursor + 1) {
<a name="l00382"></a>00382                 <a class="code" href="_m_i_message_8c.html#a5b1bc10a9354d0ad365fc55123dba947" title="Gets a Message from another object. Use this to avoid casts.">getMessage</a>(<span class="keyword">self</span>)-&gt;<a class="code" href="struct_m_i_message.html#aeb0776cff292839518da5f5a48884fd9">onErrorReceived</a>(
<a name="l00383"></a>00383                                 <a class="code" href="_m_i_constants_8h.html#a78789cd8e7333545dd73768531261968aea18ededd7bee318c95d90cff53fffba">_ERROR_MESSAGE_SERIALISATION_BAD_BYTES</a>,
<a name="l00384"></a>00384                                 <span class="stringliteral">&quot;Attempting to serialise a Block with less bytes than required for the header, transaction number var int and at least a null byte. %i &lt; %i\n&quot;</span>,
<a name="l00385"></a>00385                                 bytes-&gt;<a class="code" href="struct_m_i_byte_array.html#aebb70c2aab3407a9f05334c47131a43b">length</a>, cursor);
<a name="l00386"></a>00386                 <span class="keywordflow">return</span> 0;
<a name="l00387"></a>00387         }
<a name="l00388"></a>00388         <span class="comment">/* Deal with the header */</span>
<a name="l00389"></a>00389         <a class="code" href="_m_i_block_8c.html#a3a23a3b87c401a07d3f8b224355d523a">dealWithSerializationHeader</a>(<span class="keyword">self</span>, bytes);
<a name="l00390"></a>00390 
<a name="l00391"></a>00391         <span class="comment">/* Deal with the Transactions */</span>
<a name="l00392"></a>00392         <a class="code" href="_m_i_var_len_int_8c.html#a332f03b156163565574788bc3cedd522" title="Encodes variable size integer into bytes.">encodeVarLenInt</a>(bytes, 80, numOfTransactions);
<a name="l00393"></a>00393         cursor = <a class="code" href="_m_i_block_8c.html#a3fa07e825a149c98d148b215a5d5a78a">dealWithSerializationTran</a>(<span class="keyword">self</span>, bytes, cursor, transactions);
<a name="l00394"></a>00394         <span class="keywordflow">return</span> cursor;
<a name="l00395"></a>00395 
<a name="l00396"></a>00396 }
<a name="l00397"></a>00397 
<a name="l00401"></a><a class="code" href="_m_i_block_8h.html#a3a23a3b87c401a07d3f8b224355d523a">00401</a> <span class="keywordtype">void</span> <a class="code" href="_m_i_block_8c.html#a3a23a3b87c401a07d3f8b224355d523a">dealWithSerializationHeader</a>(<a class="code" href="struct_m_i_block.html">Block</a> * <span class="keyword">self</span>, <a class="code" href="struct_m_i_byte_array.html" title="Structure for ByteArray objects.">ByteArray</a> * bytes) {
<a name="l00402"></a>00402         assert(<span class="keyword">self</span>!=NULL &amp;&amp; bytes!=NULL);
<a name="l00403"></a>00403         <a class="code" href="_m_i_byte_array_8c.html#aa4d465553a3c7f80c1700316f2410b40" title="Writes a 32 bit integer to a ByteArray as little-endian.">writeInt32AsLittleEndianIntoByteArray</a>(bytes, 0, self-&gt;version);
<a name="l00404"></a>00404         <a class="code" href="_m_i_byte_array_8c.html#a949c73acfab0c6c4d83ad8c07d999364" title="Copies another byte array to this byte array.">copyByteArrayToByteArray</a>(bytes, 4, self-&gt;previousBlockHash);
<a name="l00405"></a>00405         <a class="code" href="_m_i_byte_array_8c.html#a949c73acfab0c6c4d83ad8c07d999364" title="Copies another byte array to this byte array.">copyByteArrayToByteArray</a>(self-&gt;previousBlockHash, bytes, 4);
<a name="l00406"></a>00406         <a class="code" href="_m_i_byte_array_8c.html#a949c73acfab0c6c4d83ad8c07d999364" title="Copies another byte array to this byte array.">copyByteArrayToByteArray</a>(bytes, 36, self-&gt;merkleTreeRootHash);
<a name="l00407"></a>00407         <a class="code" href="_m_i_byte_array_8c.html#a949c73acfab0c6c4d83ad8c07d999364" title="Copies another byte array to this byte array.">copyByteArrayToByteArray</a>(self-&gt;merkleTreeRootHash, bytes, 36);
<a name="l00408"></a>00408         <a class="code" href="_m_i_byte_array_8c.html#aa4d465553a3c7f80c1700316f2410b40" title="Writes a 32 bit integer to a ByteArray as little-endian.">writeInt32AsLittleEndianIntoByteArray</a>(bytes, 68, self-&gt;time);
<a name="l00409"></a>00409         <a class="code" href="_m_i_byte_array_8c.html#aa4d465553a3c7f80c1700316f2410b40" title="Writes a 32 bit integer to a ByteArray as little-endian.">writeInt32AsLittleEndianIntoByteArray</a>(bytes, 72, self-&gt;target);
<a name="l00410"></a>00410         <a class="code" href="_m_i_byte_array_8c.html#aa4d465553a3c7f80c1700316f2410b40" title="Writes a 32 bit integer to a ByteArray as little-endian.">writeInt32AsLittleEndianIntoByteArray</a>(bytes, 76, self-&gt;nonce);
<a name="l00411"></a>00411 }
<a name="l00412"></a>00412 
<a name="l00416"></a><a class="code" href="_m_i_block_8h.html#a3fa07e825a149c98d148b215a5d5a78a">00416</a> uint32_t <a class="code" href="_m_i_block_8c.html#a3fa07e825a149c98d148b215a5d5a78a">dealWithSerializationTran</a>(<a class="code" href="struct_m_i_block.html">Block</a> * <span class="keyword">self</span>, <a class="code" href="struct_m_i_byte_array.html" title="Structure for ByteArray objects.">ByteArray</a> * bytes,
<a name="l00417"></a>00417                 uint32_t cursor, <span class="keywordtype">int</span> transactions) {
<a name="l00418"></a>00418         assert(<span class="keyword">self</span>!=NULL &amp;&amp; bytes!=NULL &amp;&amp; cursor !=NULL);
<a name="l00419"></a>00419         <span class="keywordflow">if</span> (transactions) {
<a name="l00420"></a>00420                 uint32_t x;
<a name="l00421"></a>00421                 <span class="keywordflow">for</span> (x = 0; x &lt; <span class="keyword">self</span>-&gt;numOfTransactions; x++) {
<a name="l00422"></a>00422                         <a class="code" href="_m_i_message_8c.html#a5b1bc10a9354d0ad365fc55123dba947" title="Gets a Message from another object. Use this to avoid casts.">getMessage</a>(self-&gt;transactions[x])-&gt;<a class="code" href="struct_m_i_message.html#a8fb493ee3c32dd3a9fb29bc71c852f86">bytes</a>
<a name="l00423"></a>00423                                         = <a class="code" href="_m_i_byte_array_8c.html#a22681d5a43566996273c64d34d669806" title="References a subsection of a ByteArray.">getByteArraySubsectionReference</a>(bytes, cursor,
<a name="l00424"></a>00424                                                         bytes-&gt;<a class="code" href="struct_m_i_byte_array.html#aebb70c2aab3407a9f05334c47131a43b">length</a> - cursor);
<a name="l00425"></a>00425                         <span class="keywordflow">if</span> (!<a class="code" href="_m_i_message_8c.html#a5b1bc10a9354d0ad365fc55123dba947" title="Gets a Message from another object. Use this to avoid casts.">getMessage</a>(self-&gt;transactions[x])-&gt;<a class="code" href="struct_m_i_message.html#a8fb493ee3c32dd3a9fb29bc71c852f86">bytes</a>) {
<a name="l00426"></a>00426                                 <a class="code" href="_m_i_message_8c.html#a5b1bc10a9354d0ad365fc55123dba947" title="Gets a Message from another object. Use this to avoid casts.">getMessage</a>(<span class="keyword">self</span>)-&gt;<a class="code" href="struct_m_i_message.html#aeb0776cff292839518da5f5a48884fd9">onErrorReceived</a>(
<a name="l00427"></a>00427                                                 <a class="code" href="_m_i_constants_8h.html#a78789cd8e7333545dd73768531261968ac44c4a273612af5ceabd09df473706f4">_ERROR_INIT_FAIL</a>,
<a name="l00428"></a>00428                                                 <span class="stringliteral">&quot;Cannot create a new ByteArray sub reference in dealWithSerializationTran for the transaction number %u&quot;</span>,
<a name="l00429"></a>00429                                                 x);
<a name="l00430"></a>00430                                 <span class="keywordflow">return</span> 0;
<a name="l00431"></a>00431                         }
<a name="l00432"></a>00432                         uint32_t len = <a class="code" href="_m_i_transaction_8c.html#a1abc45d369c2884698692d79091f5b2c" title="Serialises a Transaction to byte data.">serializeTransaction</a>(self-&gt;transactions[x]);
<a name="l00433"></a>00433                         <span class="keywordflow">if</span> (!len) {
<a name="l00434"></a>00434                                 <a class="code" href="_m_i_message_8c.html#a5b1bc10a9354d0ad365fc55123dba947" title="Gets a Message from another object. Use this to avoid casts.">getMessage</a>(<span class="keyword">self</span>)-&gt;<a class="code" href="struct_m_i_message.html#aeb0776cff292839518da5f5a48884fd9">onErrorReceived</a>(
<a name="l00435"></a>00435                                                 <a class="code" href="_m_i_constants_8h.html#a78789cd8e7333545dd73768531261968aea18ededd7bee318c95d90cff53fffba">_ERROR_MESSAGE_SERIALISATION_BAD_BYTES</a>,
<a name="l00436"></a>00436                                                 <span class="stringliteral">&quot;Block cannot be serialized because of an error with the transaction number %u.&quot;</span>,
<a name="l00437"></a>00437                                                 x);
<a name="l00438"></a>00438                                 <span class="keywordflow">return</span> 0;
<a name="l00439"></a>00439                         }
<a name="l00440"></a>00440                         <a class="code" href="_m_i_message_8c.html#a5b1bc10a9354d0ad365fc55123dba947" title="Gets a Message from another object. Use this to avoid casts.">getMessage</a>(self-&gt;transactions[x])-&gt;<a class="code" href="struct_m_i_message.html#a8fb493ee3c32dd3a9fb29bc71c852f86">bytes</a>-&gt;<a class="code" href="struct_m_i_byte_array.html#aebb70c2aab3407a9f05334c47131a43b">length</a> = len;
<a name="l00441"></a>00441                         cursor += len;
<a name="l00442"></a>00442                 }
<a name="l00443"></a>00443         } <span class="keywordflow">else</span> {
<a name="l00445"></a>00445                 <a class="code" href="_m_i_byte_array_8c.html#a4e0892416e1efc8384687e86966ed3a1" title="Set a byte into the array. This will be set at self-&gt;offset+index in the underlying data...">setByteInByteArray</a>(bytes, cursor, 0);
<a name="l00446"></a>00446                 cursor++;
<a name="l00447"></a>00447         }
<a name="l00448"></a>00448         <span class="keywordflow">return</span> cursor;
<a name="l00449"></a>00449 }
<a name="l00450"></a>00450 
</pre></div></div>
</div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Defines</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<hr class="footer"/><address class="footer"><small>Generated on Thu Oct 11 2012 22:46:41 for Bitcoin by&#160;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.4 </small></address>
</body>
</html>
