<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>Bitcoin: Object/Message/Block.h Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body onload='searchBox.OnSelectItem(0);'>
<!-- Generated by Doxygen 1.7.4 -->
<script type="text/javascript"><!--
var searchBox = new SearchBox("searchBox", "search",false,'Search');
--></script>
<div id="top">
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">Bitcoin&#160;<span id="projectnumber">1.0</span></div>
   <div id="projectbrief">Bitcoin port</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li id="searchli">
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
<div class="header">
  <div class="headertitle">
<div class="title">Object/Message/Block.h</div>  </div>
</div>
<div class="contents">
<a href="_m_i_block_8h.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/*</span>
<a name="l00002"></a>00002 <span class="comment"> * Block.h</span>
<a name="l00003"></a>00003 <span class="comment"> *</span>
<a name="l00004"></a>00004 <span class="comment"> *  Created on: 04/10/2012</span>
<a name="l00005"></a>00005 <span class="comment"> *  Created by: Wen Shen</span>
<a name="l00006"></a>00006 <span class="comment"> *  Copyright (c) 2012 Bitcoin Project Team</span>
<a name="l00007"></a>00007 <span class="comment"> */</span>
<a name="l00008"></a>00008 
<a name="l00013"></a>00013 <span class="preprocessor">#ifndef BLOCK_H_</span>
<a name="l00014"></a>00014 <span class="preprocessor"></span><span class="preprocessor">#define BLOCK_H_</span>
<a name="l00015"></a>00015 <span class="preprocessor"></span>
<a name="l00016"></a>00016 <span class="preprocessor">#include &quot;<a class="code" href="_m_i_transaction_8h.html">Transaction.h</a>&quot;</span>
<a name="l00017"></a>00017 <span class="preprocessor">#include &quot;../../BigInt/BigInt.h&quot;</span>
<a name="l00018"></a>00018 <span class="preprocessor">#include &quot;../../Constants.h&quot;</span>
<a name="l00019"></a>00019 
<a name="l00023"></a><a class="code" href="struct_m_i_block.html">00023</a> <span class="keyword">typedef</span> <span class="keyword">struct </span>{
<a name="l00024"></a><a class="code" href="struct_m_i_block.html#a487e4843cf1cf7397eb2e1bcf91cbf3b">00024</a>         <a class="code" href="struct_m_i_message.html" title="Structure for Message objects.">Message</a> <a class="code" href="struct_m_i_block.html#a487e4843cf1cf7397eb2e1bcf91cbf3b">base</a>; <span class="comment">/* Message base structure */</span>
<a name="l00025"></a><a class="code" href="struct_m_i_block.html#a7ff9da008bf055da1f1ba994c562057d">00025</a>         uint8_t hash[32]; <span class="comment">/* The hash for this block. NULL if it needs to be calculated or set. */</span>
<a name="l00026"></a><a class="code" href="struct_m_i_block.html#acd99bb05ca015e7d74448acb1deba7ca">00026</a>         uint32_t <a class="code" href="struct_m_i_block.html#acd99bb05ca015e7d74448acb1deba7ca">version</a>;
<a name="l00027"></a><a class="code" href="struct_m_i_block.html#a942caf6700f7eee4a96b41503337886c">00027</a>         <a class="code" href="struct_m_i_byte_array.html" title="Structure for ByteArray objects.">ByteArray</a> * <a class="code" href="struct_m_i_block.html#a942caf6700f7eee4a96b41503337886c">previousBlockHash</a>; <span class="comment">/* The previous block hash. */</span>
<a name="l00028"></a><a class="code" href="struct_m_i_block.html#a04cf19a780652ad8d0123ed9fa18b408">00028</a>         <a class="code" href="struct_m_i_byte_array.html" title="Structure for ByteArray objects.">ByteArray</a> * <a class="code" href="struct_m_i_block.html#a04cf19a780652ad8d0123ed9fa18b408">merkleTreeRootHash</a>; <span class="comment">/* The merkle tree root hash. */</span>
<a name="l00029"></a><a class="code" href="struct_m_i_block.html#ae73654f333e4363463ad8c594eca1905">00029</a>         uint32_t <a class="code" href="struct_m_i_block.html#ae73654f333e4363463ad8c594eca1905">time</a>; <span class="comment">/* Timestamp for the block. The network uses 32 bits. The protocol can be future proofed by detecting overflows when going through the blocks. So if a block&#39;s time overflows such that the time is less than the median of the last 10 blocks, the block can be seen by adding the first 32 bits of the network time and finally the timestamp can be tested against the network time. The overflow problem can therefore be fixed by a workaround but it is a shame Satoshi did not use 64 bits. */</span>
<a name="l00030"></a><a class="code" href="struct_m_i_block.html#a695e5800ad1fd403c0e72d918eaec97c">00030</a>         uint32_t <a class="code" href="struct_m_i_block.html#a695e5800ad1fd403c0e72d918eaec97c">target</a>; <span class="comment">/* The compact target representation. */</span>
<a name="l00031"></a><a class="code" href="struct_m_i_block.html#aa2f9785a9d9116cc4592db06375cb887">00031</a>         uint32_t <a class="code" href="struct_m_i_block.html#aa2f9785a9d9116cc4592db06375cb887">nonce</a>; <span class="comment">/* Nonce used in generating the block. */</span>
<a name="l00032"></a><a class="code" href="struct_m_i_block.html#ac9749ca92207f8d50ecc2b0f904e2424">00032</a>         uint32_t <a class="code" href="struct_m_i_block.html#ac9749ca92207f8d50ecc2b0f904e2424">numOfTransactions</a>; <span class="comment">/* Number of transactions in the block. */</span>
<a name="l00033"></a><a class="code" href="struct_m_i_block.html#a722f3f2bbe4a11072741a214e2750a42">00033</a>         <a class="code" href="struct_m_i_transaction.html" title="Structure for Transaction objects.">Transaction</a> ** <a class="code" href="struct_m_i_block.html#a722f3f2bbe4a11072741a214e2750a42">transactions</a>; <span class="comment">/* The transactions included in this block. NULL if only the header has been received. */</span>
<a name="l00034"></a>00034 } <a class="code" href="struct_m_i_block.html">Block</a>;
<a name="l00035"></a>00035 
<a name="l00040"></a>00040 <a class="code" href="struct_m_i_block.html">Block</a> * <a class="code" href="_m_i_block_8c.html#a32a782c3e422cc5b132abaddc4eecf13" title="Creates a new Block object. Set the members after creating the block object.">createNewBlock</a>(<span class="keywordtype">void</span>(*onErrorReceived)(<a class="code" href="_m_i_constants_8h.html#a78789cd8e7333545dd73768531261968">Error</a> error, <span class="keywordtype">char</span> *, ...));
<a name="l00046"></a>00046 <a class="code" href="struct_m_i_block.html">Block</a> * <a class="code" href="_m_i_block_8c.html#aaddeaac51a35b3b98ade3340b6d46bac" title="Creates a new Block object from serialized block data.">createNewBlockFromByteArray</a>(<a class="code" href="struct_m_i_byte_array.html" title="Structure for ByteArray objects.">ByteArray</a> * data,
<a name="l00047"></a>00047                 <span class="keywordtype">void</span>(*onErrorReceived)(<a class="code" href="_m_i_constants_8h.html#a78789cd8e7333545dd73768531261968">Error</a> error, <span class="keywordtype">char</span> *, ...));
<a name="l00053"></a>00053 <a class="code" href="struct_m_i_block.html">Block</a> * <a class="code" href="_m_i_block_8h.html#a695158b8dbbb38ca10edd0bcabe23a77" title="Creates a new Block object with the original block for the bitcoin block chain. This will have seri...">createNewBlockWithOriginalBlock</a>(
<a name="l00054"></a>00054                 <span class="keywordtype">void</span>(*onErrorReceived)(<a class="code" href="_m_i_constants_8h.html#a78789cd8e7333545dd73768531261968">Error</a> error, <span class="keywordtype">char</span> *, ...));
<a name="l00055"></a>00055 
<a name="l00061"></a>00061 <a class="code" href="struct_m_i_block.html">Block</a> * <a class="code" href="_m_i_block_8c.html#ad48f71d612a4ef0e4e691549b8e4530e" title="Gets a Block from another object. Use this to avoid casts.">getBlock</a>(<span class="keywordtype">void</span> * <span class="keyword">self</span>);
<a name="l00062"></a>00062 
<a name="l00068"></a>00068 <span class="keywordtype">int</span> <a class="code" href="_m_i_block_8c.html#aff02edfeca99bc15719c64dbc47eb7ba" title="Initializes a Block object.">initBlock</a>(<a class="code" href="struct_m_i_block.html">Block</a> * <span class="keyword">self</span>,
<a name="l00069"></a>00069                 <span class="keywordtype">void</span>(*onErrorReceived)(<a class="code" href="_m_i_constants_8h.html#a78789cd8e7333545dd73768531261968">Error</a> error, <span class="keywordtype">char</span> *, ...));
<a name="l00076"></a>00076 <span class="keywordtype">int</span> <a class="code" href="_m_i_block_8c.html#adb55432064c1fb591abf43542ed6261e" title="Initializes a Block object from serialized data.">initBlockFromByteArray</a>(<a class="code" href="struct_m_i_block.html">Block</a> * <span class="keyword">self</span>, <a class="code" href="struct_m_i_byte_array.html" title="Structure for ByteArray objects.">ByteArray</a> * data,
<a name="l00077"></a>00077                 <span class="keywordtype">void</span>(*onErrorReceived)(<a class="code" href="_m_i_constants_8h.html#a78789cd8e7333545dd73768531261968">Error</a> error, <span class="keywordtype">char</span> *, ...));
<a name="l00078"></a>00078 
<a name="l00085"></a>00085 <span class="keywordtype">int</span> <a class="code" href="_m_i_block_8c.html#ab4caa099f720462b32d9e74406309b1d" title="Initializes a Block object with the original block for the bitcoin block chain. This will have seri...">initBlockWithOriginalBlock</a>(<a class="code" href="struct_m_i_block.html">Block</a> * <span class="keyword">self</span>,
<a name="l00086"></a>00086                 <span class="keywordtype">void</span>(*onErrorReceived)(<a class="code" href="_m_i_constants_8h.html#a78789cd8e7333545dd73768531261968">Error</a> error, <span class="keywordtype">char</span> *, ...));
<a name="l00087"></a>00087 
<a name="l00092"></a>00092 <span class="keywordtype">void</span> <a class="code" href="_m_i_block_8c.html#a89f003068369d45ffd1c8af41cfadf72" title="Frees a Block object.">deleteBlock</a>(<span class="keywordtype">void</span> * vself);
<a name="l00093"></a>00093 
<a name="l00099"></a>00099 <span class="keywordtype">void</span> <a class="code" href="_m_i_block_8c.html#a3913a1a3d961d7cc2c479de327337bae" title="Calculates the hash for a block.">calculateBlockHash</a>(<a class="code" href="struct_m_i_block.html">Block</a> * <span class="keyword">self</span>, uint8_t * hash);
<a name="l00106"></a>00106 uint32_t <a class="code" href="_m_i_block_8c.html#ab3c577ac4b13bc68f0ac3f82159969a6" title="Calculates the length needed to serialize the object.">calculateBlockLength</a>(<a class="code" href="struct_m_i_block.html">Block</a> * <span class="keyword">self</span>, <span class="keywordtype">int</span> transactions);
<a name="l00113"></a>00113 uint32_t <a class="code" href="_m_i_block_8c.html#a9b85a6f60672aea0471f7b6a7e9930ba" title="Deserializes a Block so that it can be used as an object.">deserializeBlock</a>(<a class="code" href="struct_m_i_block.html">Block</a> * <span class="keyword">self</span>, <span class="keywordtype">int</span> transactions);
<a name="l00121"></a>00121 uint32_t <a class="code" href="_m_i_block_8c.html#a292775bd99c32b5b2f51b8d71d10812e">deserializeWithOnlyHeaders</a>(<a class="code" href="struct_m_i_block.html">Block</a> * <span class="keyword">self</span>, uint8_t firstByte, <a class="code" href="struct_m_i_byte_array.html" title="Structure for ByteArray objects.">ByteArray</a> * bytes);
<a name="l00128"></a>00128 uint32_t <a class="code" href="_m_i_block_8c.html#a04d2d2defba76492762c0eb4b7ccd206">deserializeWithTransactions</a> (<a class="code" href="struct_m_i_block.html">Block</a> * <span class="keyword">self</span>, <a class="code" href="struct_m_i_byte_array.html" title="Structure for ByteArray objects.">ByteArray</a> * bytes);
<a name="l00134"></a>00134 uint8_t * <a class="code" href="_m_i_block_8c.html#ae70cfa84a85cccf1f7a669a04acd82ce" title="Retrieves or calculates the hash for a block. Hashes taken from this function are cached...">getBlockHash</a>(<a class="code" href="struct_m_i_block.html">Block</a> * <span class="keyword">self</span>);
<a name="l00141"></a>00141 uint32_t <a class="code" href="_m_i_block_8c.html#a3dab3fff46c9b386501414a6b13f5192" title="Serializes a Block to the byte data.">serializeBlock</a>(<a class="code" href="struct_m_i_block.html">Block</a> * <span class="keyword">self</span>, <span class="keywordtype">int</span> transactions);
<a name="l00147"></a>00147 <span class="keywordtype">void</span> <a class="code" href="_m_i_block_8c.html#a3a23a3b87c401a07d3f8b224355d523a">dealWithSerializationHeader</a>(<a class="code" href="struct_m_i_block.html">Block</a> * <span class="keyword">self</span>, <a class="code" href="struct_m_i_byte_array.html" title="Structure for ByteArray objects.">ByteArray</a> * bytes);
<a name="l00155"></a>00155 uint32_t <a class="code" href="_m_i_block_8c.html#a3fa07e825a149c98d148b215a5d5a78a">dealWithSerializationTran</a>(<a class="code" href="struct_m_i_block.html">Block</a> * <span class="keyword">self</span>, <a class="code" href="struct_m_i_byte_array.html" title="Structure for ByteArray objects.">ByteArray</a> * bytes,
<a name="l00156"></a>00156                 uint32_t cursor, <span class="keywordtype">int</span> transactions);
<a name="l00157"></a>00157 
<a name="l00158"></a>00158 <span class="preprocessor">#endif </span><span class="comment">/* BLOCK_H_ */</span>
</pre></div></div>
</div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Defines</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<hr class="footer"/><address class="footer"><small>Generated on Thu Oct 11 2012 22:46:41 for Bitcoin by&#160;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.4 </small></address>
</body>
</html>
